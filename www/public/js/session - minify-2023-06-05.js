var e="https://mwpf.co.za/mobile/server/";$(document).ready((function(){console.log("ready!");$("#loggedIn").hide(),$("#selectQuestion").hide(),$("#labelOpt").hide(),$("#btnProceed").hide(),$((function(){$("#selectQuestion").on("change",(function(e){console.log(e.type+" event with:",$(this).val()),localStorage.setItem("userAnswer",$(this).val()),!0===$(this).val()?$("#btnRegister").show():($("#btnRegister").prop("disabled",!0),alert($(this).val()))}))})),$("#btnRecovery").click((function(){var e=$("#username_f").val();null===$("#username_f").val()?alert("Please type your Mobile App Username"):$.ajax({url:"https://mwpf.co.za/mobile/server/api/recovery.php",type:"POST",data:{user:e},dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){console.log(e);var o=JSON.parse(JSON.stringify(e));("success"===o.status||"error"===o.status)&&alert(o.message)},error:function(e,o,t){}})})),$("#guide").hide(),$("#btnLogin").click((function(){var o=$("#username").val(),t=$("#password").val();""==$("#username").val()&&""==$("#password").val()?(swal({text:"Please Enter Your Login Details",icon:"warning",buttons:!0,dangerMode:!0}),$("#loginSpace").hide()):""==$("#username").val()?swal({text:"Please Enter Your Industry Number",icon:"warning",buttons:!0,dangerMode:!0}):""==$("#password").val()?(swal({text:"Please Enter Your Password",icon:"warning",buttons:!0,dangerMode:!0}),$("#loginSpace").hide()):($("#loader").show(),$.ajax({url:e+"api/login.php",type:"POST",data:JSON.stringify({url:"https://mobile.mwpf.co.za/api/Loginv2",parameters:{Username:o,Password:t}}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){console.log(e),!0===e.Authenticated?(localStorage.setItem("SessionKey",e.SessionKey),localStorage.setItem("personID",e.UserID),localStorage.setItem("MemberName",e.Surname),localStorage.setItem("newPassword",e.NewPasswordRequired),swal({text:"You are Logged In",icon:"success",buttons:!0,dangerMode:!1}),$("#loginmenu").hide(),$("#signin").hide(),$("#emp").hide(),$("#loginSpace").hide(),$("#loggedIn").show(),$("#logged").show(),$("#guide").show()):!1===e.Authenticated&&(swal({text:"Invalid Credentials !",icon:"warning",buttons:!0,dangerMode:!0}),$("#logged").hide(),$("#loginSpace").hide())},error:function(e){alert("Error"),swal({text:"Something went wrong !",icon:"warning",buttons:!0,dangerMode:!0}),$("#logged").hide()}}))})),$("#btnRegister").click((function(){var o=$("#surname").val(),t=$("#industryNo").val(),s=$("#mobile").val();return""==o?(alert("Please type the surname !"),!1):""==t?(alert("Please type the industry number !"),!1):""==s?(alert("Please type the mobile number !"),!1):($("#loader").show(),void $.ajax({url:e+"api/verify.php",type:"POST",data:JSON.stringify({url:"https://mobile.mwpf.co.za/api/VerifyMember",parameters:{surname:o,LookupValue:t}}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){$("#selectQuestion").show(),$("#labelOpt").show(),clients=e.Client,localStorage.setItem("userID",e.UserID[0]),!0===e.Success?null!=e.UserID[0]?($("#btnProceed").show(),$("#btnRegister").hide(),$("#selectQuestion").append("<option value='#'> Please select the company you worked for </option>"),$.each(clients,(function(e,o){console.log(o),$("#selectQuestion").append("<option value='"+o.Value+"'>"+o.Key+"</option>")}))):($("#selectQuestion").hide(),$("#labelOpt").hide(),alert("Sorry, member not found!")):e.UserID[0]===o?($("#selectQuestion").hide(),alert("You have an existing username, please use the forgot password functionality.")):!1===e.Success&&($("#selectQuestion").hide(),alert(e.Message))},error:function(e){swal({text:"Something went wrong !",icon:"warning",buttons:!0,dangerMode:!0}),$("#logged").hide()}}))})),$("#btnProceed").click((function(){$("#btnRegister").hide();var o=$("#surname").val(),t=($("#industryNo").val(),$("#mobile").val());$("#loader").show(),$.ajax({url:e+"api/getUserCredentials.php",type:"GET",data:{userID:localStorage.getItem("userID"),userAnswer:localStorage.getItem("userAnswer")},contentType:"application/json; charset=utf-8",dataType:"json",success:function(s){var a=JSON.parse(JSON.stringify(s)),n=JSON.parse(a.object);console.log(n);var r=JSON.parse(a.object);console.log(r.Password),"success"===a.status?(console.log("GET NEW USER CREDENTIALS"),console.log("Data 2"),console.log(r.UserName),console.log(r.Password),function(o,t,s,a){console.log(s),console.log(a),$.ajax({url:e+"api/sendSms.php",type:"POST",data:{mobile:o,surname:t,industryNo:s,password:a},contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(e){var o=JSON.parse(e);console.log(o),e?console.log("SMS CREDENTIALS SENT"):console.log(o)},error:function(e){}})}(t,o,r.UserName,r.Password),alert("Your registration was successful, an sms will be sent shortly"),window.location.replace("index.html")):"failed"===a.status?(alert("Sorry your anwer was incorrect"),window.location.replace("index.html")):console.log(a)},error:function(e){}})}))}));